var drawTool=null;
require("esri/map esri/toolbars/draw esri/graphic esri/symbols/SimpleFillSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleMarkerSymbol esri/Color esri/geometry/geometryEngine esri/request dojo/dom dojo/dom-attr dojo/dom-class dojo/on dojo/domReady!".split(" "),function(v,p,w,x,h,q,l,y,z,d,e,f,m){function A(a){var b=e.get(this,"id");e.get(this,"class");var c=f.contains(this,"drawing");r.forEach(function(a){e.get(a,"id")===b?(c&&(n(a,"undrawing"),drawTool.deactivate(),g.graphics.clear()),c||
(n(a,"drawing"),drawTool.activate(p[b]))):n(a,"undrawing")})}function n(a,b){f.remove(a,"undrawing");f.remove(a,"drawing");f.add(a,b);f.remove(a,"teal");"drawing"===b&&f.add(a,"teal")}function B(a){a=a.geometry;k.forEach(function(a){e.set(a,"value","")});g.graphics.clear();t(a,k[0]);u(a);$("#isBuffer").checkbox("is checked")&&(a=C(a),t(a,k[1]),u(a))}function C(a){var b=$("#units").val(),c=$("#distance").val();return y.geodesicBuffer(a,c,b,!0)}function t(a,b){var c="point"===a.type?JSON.stringify({x:a.x,
y:a.y,spatialReference:a.spatialReference}):"polyline"===a.type?JSON.stringify({paths:a.paths,spatialReference:a.spatialReference}):"polygon"===a.type?JSON.stringify({rings:a.rings,spatialReference:a.spatialReference}):void 0;e.set(b,"value",c)}function u(a){var b=a.type;if("point"===b){b=new l([237,131,33,1]);var c=new h;c.setWidth(2.25);c.setColor(b);var d=new q;d.setAngle(360);d.setColor(b);d.setOutline(c);d.setSize(24);d.setPath("M16,3.5c-4.142,0-7.5,3.358-7.5,7.5c0,4.143,7.5,18.121,7.5,18.121S23.5,15.143,23.5,11C23.5,6.858,20.143,3.5,16,3.5z M16,14.584c-1.979,0-3.584-1.604-3.584-3.584S14.021,7.416,16,7.416S19.584,9.021,19.584,11S17.979,14.584,16,14.584z");
d.setStyle(q.STYLE_PATH);b=d}else"polyline"===b?(b=new l([237,131,33,1]),c=new h,c.setStyle(h.STYLE_SOLID),c.setWidth(3),c.setColor(b),b=c):"polygon"===b?(b=new h,b.setWidth(2),b.setStyle(h.STYLE_DASH),b.setColor(new l([255,255,255,.85])),c=new x,c.setColor(new l([255,85,0,.28])),c.setOutline(b),b=c):b=void 0;c=new w;c.setGeometry(a);c.setSymbol(b);g.graphics.add(c)}function D(){console.log("click");k.forEach(function(a){e.set(a,"value","")})}function E(a){a=a.target.value.toLowerCase();dojo.isIE&&
(a=a.split("\\"),a=a[a.length-1]);-1!==a.indexOf(".zip")?(a=a.split("."),a=a[0].replace("c:\\fakepath\\",""),dojo.byId("upload-status").innerHTML="<b>\u6b63\u5728\u8f09\u5165\u2026 </b>"+a+"<br><br>",a={filetype:"shapefile",publishParameters:JSON.stringify({name:a,targetSR:g.spatialReference,maxRecordCount:1E3,enforceInputFileSizeLimit:!0,enforceOutputJsonSizeLimit:!0,generalize:!1}),f:"json"},z({url:"https://www.arcgis.com/sharing/rest/content/features/generate",content:a,form:d.byId("uploadForm"),
handleAs:"json",callbackParamName:"callback"}).then(F).otherwise(G)):dojo.byId("upload-status").innerHTML='<p style="color:red; font-size:15px">Add shapefile as .zip file</p>'}function F(a){a.error?errorHandler(a.error):(dojo.byId("upload-status").innerHTML="",a=JSON.stringify(a.featureCollection.layers[0].featureSet.features[0].geometry),e.set(k[0],"value",a))}function G(a){dojo.byId("upload-status").innerHTML="<p style='color:red'>"+a.message+"</p>"}var g=new v("map",{basemap:"osm",center:[121.118329,
25.059745],zoom:15});$(".ui.checkbox").checkbox();$("select.dropdown").dropdown();var r=[d.byId("POINT"),d.byId("POLYLINE"),d.byId("RECTANGLE")],k=[d.byId("geoString"),d.byId("bufferString")],H=d.byId("RemoveText");g.on("load",function(){drawTool=new p(g,{showTooltips:!0});drawTool.on("draw-complete",B);r.forEach(function(a){m(a,"click",A)});m(H,"click",D);m(dojo.byId("uploadForm"),"change",E)})});